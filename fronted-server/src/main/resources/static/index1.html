<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Real-time Button Selection</title>
    <style>

        .button-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            width: 300px; /* Adjust the width as needed */
            margin: 0 auto;
        }
        .button-grid button {
            width: 100%; /* Ensure each button takes up the full width of its cell */
            height: max(50px, fit-content);
        }

        .button-grid button.selected {
            background-color: #ccc;
            pointer-events: none;
        }
    </style>


    <script type="text/javascript">



        var ws = null;

        // 加入
        function join(username) {
            // var username = document.getElementById('uid').value;

            var url = "ws://localhost:8080/ws/"+username;
            //实现化WebSocket对象，指定要连接的服务器地址与端口  建立连接
            ws = new WebSocket(url);

            ws.onmessage = function(event){
                var ta = document.getElementById('responseText');
                ta.value += event.data+"\r\n";
                // 处理服务器推送的消息
                var message = JSON.parse(event.data);
                ta.value += message.type +"\r\n";

                if (message.type == 'buttonState') {
                        // 更新按钮的状态
                        var buttonId = message.buttonId;
                        var isSelected = message.isSelected;
                        var button = document.getElementById(buttonId);
                        if (button) {
                            if (isSelected) {
                                button.classList.add('selected');
                                button.disabled = true;
                            } else {
                                button.classList.remove('selected');
                                button.disabled = false;
                            }
                        }
                    }

            };

            ws.onopen = function(event){
                var ta = document.getElementById('responseText');
                ta.value += "建立 websocket 连接... \r\n";

                ws.send("all"+":"+"initialize");

            };
            ws.onclose = function(event){
                var ta = document.getElementById('responseText');
                ta.value += "用户["+username+"] 已经离开聊天室! \r\n";
                ta.value += "关闭 websocket 连接. \r\n";
            };
        }

        // 退出
        function exit(){
            if(ws) {
                ws.close();
            }
        }

        function send(message){
            // var message = document.
            if(!window.WebSocket){return;}
            if(ws.readyState == WebSocket.OPEN){
                ws.send(message);
            }else{
                alert("WebSocket 连接没有建立成功！");
            }
        }

        function randomName(number) {
            return Math.random().toString(10).substr(2, number);
        }

        join(randomName(5));

    </script>

</head>
<body>


<form onSubmit="return false;">
    <h3>聊天室</h3>
    <textarea id="responseText" style="width: 1024px;height: 300px;"></textarea>
    <br/>
    <br />
    <label>昵称 : </label><input type="text" id="uid" /> &nbsp;
    <input type="button" value="加入聊天室" onClick="join()" /> &nbsp;

    <input type="button" value="离开聊天室" onClick="exit()" />
    <br />
    <br />
    <label>消息 : </label><input type="text" id="message" /> &nbsp; <input type="button" value="发送消息" onClick="send()" />



</form>

<div id="buttonGrid" class="button-grid"></div>

<script>

    // // 假设你有一个后端服务器端点，它返回按钮数量
    // function getButtonCount() {
    //     return fetch('/getButtonCount') // 替换为你的后端服务器端点
    //         .then(response => response.json())
    //         .then(data => data.buttonCount);
    // }
    //
    // // 使用从Redis获取的按钮数量创建按钮矩阵
    // async function createButtonMatrix() {
    //     const buttonCount = await getButtonCount();
    //     const rows = Math.ceil(Math.sqrt(buttonCount)); // 计算行数
    //     const cols = Math.ceil(buttonCount / rows); // 计算列数
    //
    //     const gridContainer = document.getElementById('buttonGrid');
    //     gridContainer.innerHTML = ''; // 清除现有内容
    //
    //     for (let i = 0; i < rows; i++) {
    //         const row = document.createElement('div');
    //         row.className = 'button-row';
    //         for (let j = 0; j < cols && i * cols + j < buttonCount; j++) {
    //             const button = document.createElement('button');
    //             button.textContent = `Button ${i * cols + j + 1}`;
    //             button.id = `button-${i * cols + j + 1}`;
    //             button.addEventListener('click', function() {
    //                 send(button.id + ":" + "ButtonClicked");
    //             });
    //             row.appendChild(button);
    //         }
    //         gridContainer.appendChild(row);
    //     }
    // }
    //
    // // 调用函数来创建按钮矩阵
    // createButtonMatrix();


    function createButtonMatrix(rows, cols) {
        const gridContainer = document.getElementById('buttonGrid');
        gridContainer.innerHTML = ''; // Clear any existing content

        for (let i = 0; i < rows; i++) {
            for (let j = 0; j < cols; j++) {
                const button = document.createElement('button');
                button.textContent = `Button ${i * cols + j + 1}`;
                button.id = `Button ${i * cols + j + 1}`;
                button.addEventListener('click', function() {
                    send(button.textContent+":"+"ButtonClicked");
                });
                gridContainer.appendChild(button);
            }
        }
    }

    // Call the function to create the 8x8 button matrix
    createButtonMatrix(8, 8);

</script>



</div>


</body>
</html>
